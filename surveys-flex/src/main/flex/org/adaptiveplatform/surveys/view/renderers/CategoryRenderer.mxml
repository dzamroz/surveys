<?xml version="1.0" encoding="utf-8"?>
<mx:HBox xmlns:mx="http://www.adobe.com/2006/mxml"
		 width="100%"
		 height="100%"
		 creationComplete="hbox1_creationCompleteHandler(event)">

	<mx:Script>
		<![CDATA[
			import mx.collections.ArrayCollection;
			import mx.controls.dataGridClasses.DataGridColumn;
			import mx.events.DropdownEvent;
			import mx.events.FlexEvent;
			
			import org.adaptiveplatform.surveys.view.FilledQuestionDetails;

			private var edited:Boolean=false;

			override public function set data(o:Object):void {
				super.data=o;
				for each (var tag:Object in arrColl) {
					if ((o.category as ArrayCollection).contains(tag.label)) {
						tag.sel=true;
					} else {
						tag.sel=false;
					}
				}
				validateNow();
			}

			private function checkBox_change(evt:Event):void {
				var ch:CheckBox=evt.currentTarget as CheckBox;
				var idx:int=int(ch.data);
				var obj:Object=arrColl.getItemAt(idx);
				obj.sel=ch.selected;
				arrColl.disableAutoUpdate();
				arrColl.setItemAt(obj, idx);
				edited=true;
			}

			private function close(event:DropdownEvent=null):void {
				if (edited) {
					var tags:ArrayCollection=new ArrayCollection();
					for each (var tag:Object in arrColl) {
						if (tag.sel) {
							tags.addItem(tag.label);
						}
					}
					(parentDocument as FilledQuestionDetails).addTag(tags,data.filledSurveyId,super.data);
					edited=false;
					arrColl.refresh();
				}
			}
			[Bindable]
			public var arrColl:ArrayCollection = new ArrayCollection([
				{label:"Positive", sel:false, tag:"pozytywne", source:"assets/images/positive.png"},
				{label:"Negative", sel:false, tag:"negatywne", source:"assets/images/negative.png"},
				{label:"Conclusion", sel:false, tag:"wniosek", source:"assets/images/conclusion.png"},
				{label:"Ignore", sel:false, tag:"ignoruj", source:"assets/images/ignore.png"}
			]);

			protected function hbox1_creationCompleteHandler(event:FlexEvent):void
			{
				selCat.dataProvider=arrColl;
			}

		]]>
	</mx:Script>
	
	<mx:Repeater id="selCat">
		<mx:Image visible="{selCat.currentItem.sel}"
				  includeInLayout="{selCat.currentItem.sel}"
				  width="30"
				  source="{selCat.currentItem.source}"/>
	</mx:Repeater>
	<!--<mx:Spacer width="100%"/>-->

	<mx:PopUpButton id="popUpButton"
					width="30"
					popUpGap="-30"
					openAlways="true"
					close="close(event)">
		<mx:popUp>
			<mx:TitleWindow id="titleWin"
							height="180"
							headerHeight="30"
							showCloseButton="true"
							verticalScrollPolicy="auto"
							horizontalScrollPolicy="off"
							close="popUpButton.dispatchEvent(new DropdownEvent(DropdownEvent.CLOSE))">

				<mx:ToolBar width="100">
					<mx:Repeater id="myRep"
								 dataProvider="{arrColl}">
						<mx:CheckBox data="{myRep.currentIndex}"
									 label="{myRep.currentItem.label}"
									 selected="{myRep.currentItem.sel}"
									 change="checkBox_change(event);"
									 width="100"/>
					</mx:Repeater>
				</mx:ToolBar>
			</mx:TitleWindow>
		</mx:popUp>
	</mx:PopUpButton>

</mx:HBox>
